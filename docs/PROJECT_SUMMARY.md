# ğŸšŒ å…¬äº¤åˆ°ç«™æé†’ç³»ç»Ÿ - é¡¹ç›®æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®æ—¶å…¬äº¤åˆ°ç«™ç›‘æ§**: æ¯10ç§’è‡ªåŠ¨æ›´æ–°å…¬äº¤æ•°æ®
- âœ… **å¤šç«™ç‚¹ç®¡ç†**: æ”¯æŒæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å¤šä¸ªå…¬äº¤ç«™ç‚¹
- âœ… **çº¿è·¯ç­›é€‰**: ä¸ºæ¯ä¸ªç«™ç‚¹é€‰æ‹©ç‰¹å®šçš„å…¬äº¤çº¿è·¯è¿›è¡Œç›‘æ§
- âœ… **æœ¬åœ°å­˜å‚¨**: ä½¿ç”¨ LocalStorage æŒä¹…åŒ–é…ç½®
- âœ… **çŠ¶æ€æç¤º**: æ™ºèƒ½æ˜¾ç¤º"å³å°†åˆ°ç«™"ã€"å¿«åˆ°äº†"ã€"åœ¨è·¯ä¸Š"

### 2. è·¨åŸŸå¤„ç†ï¼ˆé‡è¦ï¼ï¼‰
- âœ… **æœåŠ¡ç«¯ä»£ç†**: é€šè¿‡ Next.js API Routes ä»£ç†å¤–éƒ¨ API
- âœ… **CORS Headers**: åœ¨ next.config.ts ä¸­é…ç½®å“åº”å¤´
- âœ… **Middleware**: ç»Ÿä¸€å¤„ç†è·¨åŸŸè¯·æ±‚
- âœ… **OPTIONS æ”¯æŒ**: å¤„ç†æµè§ˆå™¨é¢„æ£€è¯·æ±‚
- âœ… **ä¸‰å±‚é˜²æŠ¤**: API Route + Config + Middleware

### 3. ç”¨æˆ·ç•Œé¢
- âœ… **ä¸»é¡µ**: æ˜¾ç¤ºæ‰€æœ‰ç›‘æ§ç«™ç‚¹çš„å®æ—¶å…¬äº¤ä¿¡æ¯
- âœ… **ç®¡ç†é¡µ**: æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ç«™ç‚¹é…ç½®
- âœ… **å“åº”å¼è®¾è®¡**: å®Œç¾æ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
- âœ… **ç¾è§‚UI**: æ¸å˜èƒŒæ™¯ã€æ¯›ç»ç’ƒæ•ˆæœã€åŠ¨ç”»æ•ˆæœ
- âœ… **çŠ¶æ€é¢œè‰²ç¼–ç **: çº¢è‰²/æ©™è‰²/è“è‰²åŒºåˆ†ä¸åŒåˆ°ç«™æ—¶é—´

### 4. æŠ€æœ¯å®ç°
- âœ… **Next.js 15**: ä½¿ç”¨æœ€æ–°çš„ App Router
- âœ… **TypeScript**: å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… **Tailwind CSS**: ç°ä»£åŒ–æ ·å¼ç³»ç»Ÿ
- âœ… **API Routes**: æœåŠ¡ç«¯ä»£ç†å’Œæ•°æ®å¤„ç†

## ğŸ“ é¡¹ç›®ç»“æ„

```
bus-comming/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/bus-arrival/route.ts    # API ä»£ç†ï¼ˆè§£å†³è·¨åŸŸï¼‰
â”‚   â”‚   â”œâ”€â”€ manage/page.tsx             # ç«™ç‚¹ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page.tsx                    # ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ layout.tsx                  # å…¨å±€å¸ƒå±€
â”‚   â”‚   â””â”€â”€ globals.css                 # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ middleware.ts                   # CORS ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ types/bus.ts                    # TypeScript ç±»å‹
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ busApi.ts                   # API å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ localStorage.ts             # å­˜å‚¨å·¥å…·å‡½æ•°
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ bus-arrival.html                # åŸå§‹å‚è€ƒè®¾è®¡
â”‚   â”œâ”€â”€ CORS_SOLUTION.md                # è·¨åŸŸè§£å†³æ–¹æ¡ˆæ–‡æ¡£
â”‚   â”œâ”€â”€ GETTING_STARTED.md              # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â””â”€â”€ test-cors.html                  # CORS æµ‹è¯•é¡µé¢
â”œâ”€â”€ next.config.ts                      # Next.js é…ç½®ï¼ˆå« CORSï¼‰
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ”Œ API è®¾è®¡

### ä»£ç†æ¥å£
```
GET /api/bus-arrival?code={ç«™ç‚¹ä»£ç }
```

**å·¥ä½œåŸç†**:
```
æµè§ˆå™¨ â†’ /api/bus-arrival â†’ Next.js æœåŠ¡å™¨ â†’ https://arrivelah2.busrouter.sg/
         (åŒåŸŸè¯·æ±‚)              (æœåŠ¡ç«¯ä»£ç†)        (å¤–éƒ¨ API)
```

**å“åº”æ ¼å¼**:
```json
{
  "services": [
    {
      "no": "371",
      "operator": "SBST",
      "next": { "duration_ms": 77569, ... },
      "next2": { "duration_ms": 708569, ... },
      "next3": { "duration_ms": 1428569, ... }
    }
  ]
}
```

## ğŸ¨ UI/UX ç‰¹æ€§

### ä¸»é¡µåŠŸèƒ½
1. **å®æ—¶æ›´æ–°**: å€’è®¡æ—¶æ¯ç§’æ›´æ–°ï¼Œæ•°æ®æ¯10ç§’åˆ·æ–°
2. **ä¸‰è¶Ÿæ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰ã€ä¸‹ä¸€è¶Ÿã€ä¸‹ä¸‹ä¸€è¶Ÿ
3. **çŠ¶æ€å¾½ç« **: 
   - ğŸ”´ å³å°†åˆ°ç«™ (â‰¤60ç§’) - çº¢è‰²è„‰å†²åŠ¨ç”»
   - ğŸŸ  å¿«åˆ°äº† (60-180ç§’) - æ©™è‰²
   - ğŸ”µ åœ¨è·¯ä¸Š (>180ç§’) - è“è‰²
4. **è¿›åº¦æ¡**: å¯è§†åŒ–æ˜¾ç¤ºåˆ°ç«™è¿›åº¦
5. **ä½ç½®æ ‡è¯†**: ğŸ“å®æ—¶ä½ç½® / â±ï¸é¢„è®¡æ—¶é—´

### ç®¡ç†é¡µåŠŸèƒ½
1. **æ·»åŠ ç«™ç‚¹**: è¾“å…¥åç§°ã€ä»£ç ã€çº¿è·¯å·
2. **ç¼–è¾‘ç«™ç‚¹**: ä¿®æ”¹ç°æœ‰é…ç½®
3. **åˆ é™¤ç«™ç‚¹**: ç§»é™¤ä¸éœ€è¦çš„ç«™ç‚¹
4. **è¡¨å•éªŒè¯**: å¿…å¡«å­—æ®µæ£€æŸ¥

## ğŸ’¾ æ•°æ®å­˜å‚¨

### LocalStorage ç»“æ„
```typescript
interface SavedBusStop {
  id: string;              // å”¯ä¸€æ ‡è¯†
  code: string;            // ç«™ç‚¹ä»£ç ï¼ˆå¦‚: "67661"ï¼‰
  name: string;            // è‡ªå®šä¹‰åç§°ï¼ˆå¦‚: "æ·±åœ³æ¹¾å…¬å›­ç«™"ï¼‰
  buses: string[];         // ç›‘å¬çš„çº¿è·¯ï¼ˆå¦‚: ["371", "5"]ï¼‰
  createdAt: number;       // åˆ›å»ºæ—¶é—´æˆ³
  updatedAt: number;       // æ›´æ–°æ—¶é—´æˆ³
}
```

### å­˜å‚¨é”®å
```
localStorage.getItem('bus_stops')
```

## ğŸš€ è¿è¡Œå‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
npm start

# ä»£ç æ£€æŸ¥
npm run lint
```

## ğŸ§ª æµ‹è¯•

### æµ‹è¯• CORS é…ç½®
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨: `npm run dev`
2. æ‰“å¼€æµ‹è¯•é¡µé¢: `http://localhost:3000/docs/test-cors.html`ï¼ˆéœ€è¦å°†æ–‡ä»¶æ”¾åˆ° public ç›®å½•ï¼‰
3. æˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ:
```javascript
fetch('/api/bus-arrival?code=67661')
  .then(r => r.json())
  .then(data => console.log(data))
```

### æµ‹è¯•ç«™ç‚¹é…ç½®
æ¨èæµ‹è¯•æ•°æ®ï¼š
```
ç«™ç‚¹åç§°: æµ‹è¯•ç«™ç‚¹
ç«™ç‚¹ä»£ç : 67661
ç›‘å¬çº¿è·¯: 371
```

## ğŸ“ å…³é”®æŠ€æœ¯ç‚¹

### 1. è·¨åŸŸé—®é¢˜è§£å†³ â­
é€šè¿‡ Next.js API Routes å®ç°æœåŠ¡ç«¯ä»£ç†ï¼Œå®Œç¾è§£å†³æµè§ˆå™¨ CORS é™åˆ¶ã€‚

è¯¦ç»†è¯´æ˜: [docs/CORS_SOLUTION.md](./docs/CORS_SOLUTION.md)

### 2. å®æ—¶æ›´æ–°æœºåˆ¶
```typescript
// æ¯ç§’æ›´æ–°å€’è®¡æ—¶
setInterval(updateTime, 1000);

// æ¯10ç§’åˆ·æ–°æ•°æ®
setInterval(fetchAllBusData, 10000);
```

### 3. æ•°æ®è¿‡æ»¤
```typescript
// åªæ˜¾ç¤ºç”¨æˆ·é€‰æ‹©çš„çº¿è·¯
const filteredServices = filterBusByNumber(data.services, stop.buses);
```

### 4. çŠ¶æ€è®¡ç®—
```typescript
// æ ¹æ®å‰©ä½™æ—¶é—´è®¡ç®—çŠ¶æ€
function getStatusClass(durationMs: number) {
  const seconds = Math.floor(durationMs / 1000);
  if (seconds <= 60) return 'arriving';
  if (seconds <= 180) return 'soon';
  return 'onway';
}
```

## ğŸŒŸ äº®ç‚¹åŠŸèƒ½

1. **é›¶åç«¯ä¾èµ–**: æ‰€æœ‰é…ç½®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°
2. **æœåŠ¡ç«¯ä»£ç†**: ä¼˜é›…è§£å†³è·¨åŸŸé—®é¢˜
3. **å®æ—¶ç›‘æ§**: GPS ä½ç½®è·Ÿè¸ªæ ‡è¯†
4. **æ™ºèƒ½çŠ¶æ€**: è‡ªåŠ¨è®¡ç®—å’Œæ˜¾ç¤ºå…¬äº¤çŠ¶æ€
5. **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯ä¼˜å…ˆ
6. **TypeScript**: å®Œæ•´ç±»å‹å®‰å…¨
7. **ç°ä»£åŒ– UI**: å‚è€ƒåŸå‹è®¾è®¡ï¼Œæ¯›ç»ç’ƒæ•ˆæœ

## ğŸ“Š æ•°æ®æµç¨‹

```
ç”¨æˆ·æ“ä½œ â†’ LocalStorage â†’ è¯»å–é…ç½®
                           â†“
                    ç”Ÿæˆ API è¯·æ±‚åˆ—è¡¨
                           â†“
          å¹¶å‘è¯·æ±‚ /api/bus-arrival?code=XXX
                           â†“
              Next.js API Route (æœåŠ¡ç«¯)
                           â†“
          ä»£ç†è¯·æ±‚ arrivelah2.busrouter.sg
                           â†“
                    è¿”å› JSON æ•°æ®
                           â†“
                    å‰ç«¯å¤„ç†å’Œå±•ç¤º
                           â†“
                  æŒ‰çº¿è·¯å·è¿‡æ»¤å’Œæ’åº
                           â†“
                  è®¡ç®—å€’è®¡æ—¶å’ŒçŠ¶æ€
                           â†“
                    æ¸²æŸ“åˆ° UI ç•Œé¢
```

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### `/src/app/api/bus-arrival/route.ts`
- **ä½œç”¨**: API ä»£ç†ï¼Œè§£å†³è·¨åŸŸé—®é¢˜
- **å…³é”®ç‚¹**: 
  - æœåŠ¡ç«¯è¯·æ±‚å¤–éƒ¨ API
  - æ·»åŠ  CORS headers
  - å¤„ç† OPTIONS é¢„æ£€è¯·æ±‚
  - é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### `/src/app/page.tsx`
- **ä½œç”¨**: ä¸»é¡µï¼Œæ˜¾ç¤ºå®æ—¶å…¬äº¤ä¿¡æ¯
- **å…³é”®ç‚¹**:
  - ä» LocalStorage è¯»å–é…ç½®
  - å®šæ—¶åˆ·æ–°æ•°æ®
  - çŠ¶æ€è®¡ç®—å’Œæ˜¾ç¤º
  - å“åº”å¼å¸ƒå±€

### `/src/app/manage/page.tsx`
- **ä½œç”¨**: ç®¡ç†é¡µï¼ŒCRUD ç«™ç‚¹é…ç½®
- **å…³é”®ç‚¹**:
  - è¡¨å•éªŒè¯
  - LocalStorage æ“ä½œ
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤åŠŸèƒ½

### `/src/utils/localStorage.ts`
- **ä½œç”¨**: LocalStorage å°è£…
- **å…³é”®ç‚¹**:
  - CRUD æ“ä½œ
  - æ•°æ®åºåˆ—åŒ–
  - é”™è¯¯å¤„ç†

### `/src/utils/busApi.ts`
- **ä½œç”¨**: API å·¥å…·å‡½æ•°
- **å…³é”®ç‚¹**:
  - fetch å°è£…
  - æ—¶é—´æ ¼å¼åŒ–
  - çŠ¶æ€åˆ¤æ–­
  - æ•°æ®è¿‡æ»¤

### `/src/middleware.ts`
- **ä½œç”¨**: å…¨å±€ä¸­é—´ä»¶
- **å…³é”®ç‚¹**:
  - ç»Ÿä¸€æ·»åŠ  CORS headers
  - æ‹¦æˆª API è¯·æ±‚

### `/next.config.ts`
- **ä½œç”¨**: Next.js é…ç½®
- **å…³é”®ç‚¹**:
  - headers() é…ç½® CORS
  - é€‚ç”¨äºæ‰€æœ‰ API è·¯ç”±

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

1. **æ— æ•æ„Ÿæ•°æ®**: æ‰€æœ‰é…ç½®ä»…å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨
2. **API ä»£ç†**: éšè—äº†å¤–éƒ¨ API çš„ç›´æ¥è®¿é—®
3. **è¾“å…¥éªŒè¯**: æ£€æŸ¥ç«™ç‚¹ä»£ç å’Œçº¿è·¯å·æ ¼å¼
4. **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç† API å¤±è´¥æƒ…å†µ

## ğŸ“ å­¦ä¹ è¦ç‚¹

æœ¬é¡¹ç›®å±•ç¤ºäº†ä»¥ä¸‹æŠ€æœ¯è¦ç‚¹ï¼š

1. âœ… Next.js 15 App Router çš„ä½¿ç”¨
2. âœ… æœåŠ¡ç«¯ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜
3. âœ… TypeScript ç±»å‹ç³»ç»Ÿ
4. âœ… LocalStorage æ•°æ®æŒä¹…åŒ–
5. âœ… Tailwind CSS æ ·å¼ç³»ç»Ÿ
6. âœ… React Hooks çŠ¶æ€ç®¡ç†
7. âœ… å®šæ—¶å™¨å’Œå¼‚æ­¥æ•°æ®è·å–
8. âœ… å“åº”å¼è®¾è®¡å®è·µ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®ä»‹ç»å’Œä½¿ç”¨è¯´æ˜
- [docs/CORS_SOLUTION.md](./docs/CORS_SOLUTION.md) - è·¨åŸŸè§£å†³æ–¹æ¡ˆè¯¦è§£
- [docs/GETTING_STARTED.md](./docs/GETTING_STARTED.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ‰ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§åˆ«çš„ Next.js åº”ç”¨ï¼ŒæˆåŠŸå®ç°äº†ï¼š

1. âœ… å®æ—¶å…¬äº¤ç›‘æ§åŠŸèƒ½
2. âœ… å®Œå–„çš„ç«™ç‚¹ç®¡ç†ç³»ç»Ÿ
3. âœ… ä¼˜é›…çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆé‡ç‚¹ï¼ï¼‰
4. âœ… ç¾è§‚çš„ç”¨æˆ·ç•Œé¢
5. âœ… å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
6. âœ… è‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£

**é¡¹ç›®å¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼** ğŸš€

