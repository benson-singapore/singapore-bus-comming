# 🔢 站点排序功能说明

## 功能概述

现在您可以**自定义站点的显示顺序**，让最常用的站点显示在最前面！

---

## 🎯 排序功能

### 使用方法

1. 打开**站点管理页面**（点击主页的"管理监听的站点和线路"）
2. 在每个站点卡片的**右上角**，您会看到两个箭头按钮：
   - **↑** 上移按钮 - 将站点向上移动
   - **↓** 下移按钮 - 将站点向下移动
3. 点击箭头调整顺序
4. 返回主页查看新的排序效果

### 视觉示例

```
┌─────────────────────────────────┐
│  Home 371               ↑      │ ← 第一个站点（↑按钮禁用）
│  67661                  ↓      │
│  线路: 371路                    │
│  [编辑] [删除]                  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  SengKang 371           ↑      │ ← 中间站点（两个按钮都可用）
│  67009                  ↓      │
│  线路: 371路                    │
│  [编辑] [删除]                  │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│  另一个站点              ↑      │ ← 最后一个站点（↓按钮禁用）
│  12345                  ✗      │
│  线路: 5路                      │
│  [编辑] [删除]                  │
└─────────────────────────────────┘
```

---

## 🎁 默认站点

### 首次打开应用

第一次使用时，系统会自动添加**两个默认站点**：

| 站点名称 | 站点代码 | 监听线路 |
|---------|---------|---------|
| **Home 371** | 67661 | 371路 |
| **SengKang 371** | 67009 | 371路 |

### 特点

- ✅ **自动添加**: 首次打开应用时自动创建
- ✅ **可删除**: 不需要时可以随时删除
- ✅ **可编辑**: 可以修改名称、代码和线路
- ✅ **可排序**: 和其他站点一样可以调整顺序
- ✅ **仅一次**: 删除后不会再次自动添加

### 删除默认站点

如果您不需要这些默认站点：

1. 进入站点管理页面
2. 找到对应的站点卡片
3. 点击"🗑️ 删除"按钮
4. 确认删除

**注意**: 删除后这些站点会从浏览器缓存中永久移除，不会再自动添加。

---

## 💡 排序工作原理

### 技术实现

每个站点都有一个 `sortOrder` 字段（数字）：
- 数字越小，显示越靠前
- 0 在最前面，1 在第二位，依此类推

### 上移操作
```
站点A (sortOrder: 0)
站点B (sortOrder: 1)  ← 点击上移
站点C (sortOrder: 2)

变为：

站点B (sortOrder: 0)  ← 上移成功
站点A (sortOrder: 1)
站点C (sortOrder: 2)
```

### 下移操作
```
站点A (sortOrder: 0)  ← 点击下移
站点B (sortOrder: 1)
站点C (sortOrder: 2)

变为：

站点B (sortOrder: 0)
站点A (sortOrder: 1)  ← 下移成功
站点C (sortOrder: 2)
```

---

## 🎨 用户体验

### 按钮状态

| 位置 | ↑ 上移按钮 | ↓ 下移按钮 |
|------|-----------|-----------|
| **第一个站点** | 🚫 灰色禁用 | ✅ 紫色可用 |
| **中间站点** | ✅ 紫色可用 | ✅ 紫色可用 |
| **最后站点** | ✅ 紫色可用 | 🚫 灰色禁用 |

### 视觉反馈

- **可用状态**: 紫色图标，鼠标悬停时有浅紫色背景
- **禁用状态**: 灰色图标，鼠标变为禁止符号
- **点击后**: 立即刷新页面，显示新的排序

---

## 📋 使用场景

### 场景 1: 常用站点置顶 ⭐

**需求**: 每天上下班都用"Home 371"，希望它显示在最前面

**操作**:
1. 进入站点管理
2. 反复点击"Home 371"的上移按钮
3. 直到它移到最顶部
4. 返回主页，现在它会最先显示

---

### 场景 2: 按使用频率排序 📊

**需求**: 想按照使用频率从高到低排列

**操作**:
1. 确定使用频率顺序（如：家、公司、商场）
2. 将最常用的移到最上面
3. 依次排列其他站点
4. 主页会按此顺序显示

---

### 场景 3: 按路线排序 🗺️

**需求**: 想把同一路线的站点放在一起

**操作**:
1. 将所有 371路 的站点放在一起
2. 将所有 5路 的站点放在一起
3. 便于查看同一路线的不同站点

---

### 场景 4: 临时调整 ⚡

**需求**: 今天要去一个不常去的地方

**操作**:
1. 将该站点临时移到顶部
2. 方便今天快速查看
3. 明天再移回原位置

---

## 🔄 与其他功能的配合

### 排序 + 刷新

- 排序不影响刷新功能
- 每个站点的刷新按钮独立工作
- 排序后刷新按钮位置跟随站点移动

### 排序 + 编辑

- 可以先排序再编辑
- 编辑不会改变排序位置
- 编辑后排序保持不变

### 排序 + 删除

- 删除站点后，其他站点的顺序保持不变
- 删除中间的站点，上下站点会自动衔接

### 排序 + 新增

- 新添加的站点自动排在最后
- 可以立即调整新站点的位置

---

## 💾 数据持久化

### 存储位置

排序信息保存在浏览器的 **LocalStorage** 中：
- 键名: `bus_stops`
- 包含每个站点的 `sortOrder` 字段

### 数据示例

```json
[
  {
    "id": "default-1729338000000-0",
    "name": "Home 371",
    "code": "67661",
    "buses": ["371"],
    "sortOrder": 0,
    "createdAt": 1729338000000,
    "updatedAt": 1729338000000
  },
  {
    "id": "default-1729338000000-1",
    "name": "SengKang 371",
    "code": "67009",
    "buses": ["371"],
    "sortOrder": 1,
    "createdAt": 1729338000000,
    "updatedAt": 1729338000000
  }
]
```

### 持久性

- ✅ 关闭浏览器后保留
- ✅ 刷新页面后保留
- ✅ 重启电脑后保留
- ❌ 清除浏览器数据后丢失
- ❌ 无痕模式关闭后丢失

---

## 🛠️ 技术细节

### API 函数

新增了三个排序相关的函数：

#### 1. `moveStopUp(id)`
```typescript
// 将指定站点上移一位
localStorageUtil.moveStopUp('station-id');
```

#### 2. `moveStopDown(id)`
```typescript
// 将指定站点下移一位
localStorageUtil.moveStopDown('station-id');
```

#### 3. `reorderStops(orderedIds)`
```typescript
// 批量重排序（用于拖拽等高级功能）
localStorageUtil.reorderStops(['id1', 'id2', 'id3']);
```

### 数据结构

```typescript
interface SavedBusStop {
  id: string;
  code: string;
  name: string;
  buses: string[];
  sortOrder: number;  // ← 新增字段
  createdAt: number;
  updatedAt: number;
}
```

---

## 🎯 最佳实践

### 推荐排序策略

1. **按使用频率** ⭐⭐⭐⭐⭐
   - 最常用的放最前面
   - 偶尔用的放后面
   
2. **按时间顺序** ⭐⭐⭐⭐
   - 早上用的放前面
   - 晚上用的放后面
   
3. **按地理位置** ⭐⭐⭐
   - 从家到公司的路线顺序
   - 从起点到终点排列
   
4. **按线路分组** ⭐⭐
   - 同一线路的站点放一起
   - 方便对比不同站点

---

## ⚠️ 注意事项

### 限制

1. **一次只能移动一位**: 不能直接跳到顶部或底部
2. **需要手动操作**: 没有自动排序功能
3. **无撤销功能**: 移动后不能一键恢复

### 解决方案

**如果想快速移动多位**:
- 连续点击上移/下移按钮
- 每次点击后页面会立即刷新

**如果移错了**:
- 点击相反方向的按钮
- 重新调整到正确位置

---

## 🔮 未来增强

### 计划功能

- [ ] 拖拽排序（鼠标拖动调整顺序）
- [ ] 一键置顶/置底
- [ ] 自动按名称排序
- [ ] 自动按代码排序
- [ ] 自动按使用频率排序
- [ ] 排序历史记录
- [ ] 撤销/重做功能

---

## 📝 常见问题

### Q1: 默认站点可以删除吗？

**A**: 可以！删除后不会再自动添加。

### Q2: 删除中间的站点会影响排序吗？

**A**: 不会！其他站点的相对顺序保持不变。

### Q3: 新添加的站点会出现在哪里？

**A**: 自动排在最后，然后可以手动调整位置。

### Q4: 排序信息会丢失吗？

**A**: 只要不清除浏览器数据，排序会永久保存。

### Q5: 可以同时移动多个站点吗？

**A**: 目前不支持，需要逐个调整。

### Q6: 主页的显示顺序会自动更新吗？

**A**: 会！主页始终按照 sortOrder 排序显示。

---

## 🎉 总结

### 排序功能的优势

✅ **简单直观**: 上下箭头，一目了然  
✅ **即时生效**: 点击后立即看到效果  
✅ **灵活自由**: 想怎么排就怎么排  
✅ **永久保存**: 设置一次，长期有效  
✅ **默认站点**: 开箱即用，快速上手  

### 使用建议

1. **首次使用**: 保留默认站点，体验功能
2. **熟悉后**: 删除默认站点，添加自己的
3. **日常使用**: 根据需求调整顺序
4. **定期优化**: 根据使用情况更新排序

---

**享受自定义排序带来的便利！** 🚌✨

