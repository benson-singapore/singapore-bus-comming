# 更新日志

## [1.2.2] - 2025-10-19

### 优化改进 ⚡
- **调整自动刷新频率**: 将自动刷新间隔从 10秒 改回 5秒
  - 提供更实时的公交数据
  - 更频繁的数据更新
  
### 调试增强 🔧
- **添加详细日志**: 在 Console 中显示刷新日志
  - 自动刷新时显示时间戳和站点信息
  - 手动刷新时显示详细的数据和秒数
  - 方便排查数据更新问题
  
- **防缓存措施**: 在 API 请求中添加时间戳
  - 防止浏览器缓存导致数据不更新
  - 添加 `cache: 'no-store'` 和 `Cache-Control` 头
  - 每次请求都获取最新数据

### 文档更新 📚
- 创建 DEBUG_REFRESH.md - 详细的刷新功能调试指南
- 更新 README.md - 刷新间隔说明

---

## [1.2.1] - 2025-10-19

### Bug 修复 🐛
- **修复刷新顺序bug**: 修复点击单个站点刷新按钮后导致站点乱序的问题
  - 现在手动刷新会保持原有的 sortOrder 顺序
  - 刷新后站点位置不会改变
  - 使用 Map 和排序逻辑确保顺序一致性

### 优化改进 ⚡
- **调整自动刷新频率**: 将自动刷新间隔从 5秒 改为 10秒
  - 减少服务器请求压力
  - 降低数据流量消耗
  - 保持合理的实时性

### 技术细节 🔧
- 重构 `refreshSingleStop` 函数
  - 使用 Map 保存所有线路
  - 按 `savedStops` 的 `sortOrder` 重新排序
  - 确保刷新后顺序与自动刷新一致

---

## [1.2.0] - 2025-10-19

### 新增功能 ✨
- **站点排序**: 可以通过上下箭头按钮调整站点显示顺序
  - 每个站点卡片右上角显示↑↓箭头
  - 点击箭头即可上移或下移站点
  - 第一个站点的上移按钮禁用
  - 最后一个站点的下移按钮禁用
  - 排序保存到 LocalStorage，永久有效

- **默认站点**: 首次使用自动添加两个示例站点
  - Home 371 (67661, 线路371)
  - SengKang 371 (67009, 线路371)
  - 可以正常编辑、删除这些站点
  - 删除后不会再自动添加

### 技术细节 🔧
- 在 `SavedBusStop` 接口中添加 `sortOrder` 字段
- 实现 `initializeDefaultStops()` 初始化默认站点
- 实现 `moveStopUp(id)` 和 `moveStopDown(id)` 排序功能
- 实现 `reorderStops(orderedIds)` 批量排序（为未来拖拽功能预留）
- `getBusStops()` 自动按 sortOrder 排序返回
- 创建 404 页面 (`not-found.tsx`)

### UI 改进 🎨
- 站点卡片右上角添加上下箭头按钮
- 按钮根据位置自动禁用（顶部/底部）
- 禁用状态显示灰色，可用状态显示紫色
- Hover 时紫色背景高亮
- 页面标题更新为"添加、编辑或调整站点显示顺序"

### 文档更新 📚
- 创建 SORT_FEATURE.md - 详细的排序功能说明
- 更新 README.md - 添加排序和默认站点说明
- 更新 CHANGELOG.md

---

## [1.1.0] - 2025-10-19

### 新增功能 ✨
- **单独刷新按钮**: 每个站点卡片右上角新增刷新按钮
  - 点击可立即刷新该站点的公交数据
  - 刷新时显示旋转动画效果
  - 防止重复点击（刷新中时按钮禁用）
  - 最少显示500ms的加载状态，提供更好的视觉反馈

### 优化改进 ⚡
- **更快的刷新频率**: 将自动刷新间隔从10秒缩短至5秒
  - 公交数据更加实时
  - 倒计时更准确
  - 更好的用户体验

### 技术细节 🔧
- 添加 `refreshingStops` 状态管理正在刷新的站点
- 实现 `refreshSingleStop` 函数支持单个站点刷新
- 使用 SVG 图标显示刷新按钮
- 添加 `animate-spin` 动画类
- 优化状态更新逻辑，只更新对应站点的数据

### UI 改进 🎨
- 刷新按钮采用半透明白色背景
- Hover 时背景变深
- 刷新中时显示旋转动画
- 禁用状态下不可点击

---

## [1.0.0] - 2025-10-19

### 初始版本 🎉

#### 核心功能
- ✅ 实时公交到站监控
- ✅ 多站点管理（添加/编辑/删除）
- ✅ 线路筛选
- ✅ 本地存储（LocalStorage）
- ✅ 跨域问题解决（API 代理）

#### 用户界面
- ✅ 渐变紫色主题
- ✅ 毛玻璃效果卡片
- ✅ 响应式设计
- ✅ 状态颜色编码（红/橙/蓝）
- ✅ 进度条显示
- ✅ 脉冲动画

#### 技术栈
- Next.js 15 (App Router)
- TypeScript
- Tailwind CSS
- API Routes (服务端代理)

#### 文档
- README.md - 项目说明
- CORS_SOLUTION.md - 跨域解决方案
- GETTING_STARTED.md - 快速开始
- PROJECT_SUMMARY.md - 项目总结
- FEATURES.md - 功能详解
- DEPLOYMENT.md - 部署指南
- QUICK_START.md - 5分钟上手

---

## 功能对比

| 功能 | v1.0.0 | v1.1.0 | v1.2.0 |
|------|--------|--------|--------|
| 自动刷新间隔 | 10秒 | **5秒** ⚡ | **5秒** ⚡ |
| 手动刷新 | ❌ | **✅** 🔄 | **✅** 🔄 |
| 刷新动画 | - | **✅** 🎨 | **✅** 🎨 |
| 单独刷新站点 | ❌ | **✅** 🎯 | **✅** 🎯 |
| 站点排序 | ❌ | ❌ | **✅** 🔢 |
| 默认站点 | ❌ | ❌ | **✅** 🎁 |

---

## 升级指南

### 从 v1.1.0 升级到 v1.2.0

不需要任何额外操作，直接运行：

```bash
git pull
npm install
npm run build
```

**首次打开应用时**：
- 会自动添加两个默认站点
- 如果您已有站点，不会添加默认站点
- 删除默认站点后不会再添加

### 新功能使用方法

1. **调整站点顺序**:
   - 进入站点管理页面
   - 点击站点右上角的 ↑ 或 ↓ 按钮
   - 站点会上移或下移一位
   - 返回主页查看新顺序

2. **管理默认站点**:
   - 默认站点可以正常编辑和删除
   - 删除后不会再自动添加
   - 可以根据需要修改名称和线路

### 从 v1.0.0 升级到 v1.1.0

不需要任何额外操作，直接运行：

```bash
git pull
npm install
npm run build
```

### v1.1.0 新功能使用方法

1. **单独刷新站点**:
   - 找到要刷新的站点卡片
   - 点击右上角的刷新图标
   - 等待动画完成（约0.5秒）
   - 数据自动更新

2. **更快的自动刷新**:
   - 无需任何操作
   - 系统自动每5秒更新一次
   - 页面底部显示"数据每5秒自动更新"

---

## 未来计划 🚀

### v1.3.0 (计划中)
- [ ] 拖拽排序（鼠标拖动调整顺序）
- [ ] 一键置顶/置底
- [ ] 到站提醒通知（浏览器通知）
- [ ] 站点搜索功能

### v1.4.0 (计划中)
- [ ] 地图显示（显示公交实时位置）
- [ ] 路线规划
- [ ] 历史记录统计
- [ ] PWA 支持（离线使用）

### v2.0.0 (远期)
- [ ] 暗色模式
- [ ] 多语言支持
- [ ] 云同步（账号系统）
- [ ] 自定义主题

---

## 反馈与建议

如果您有任何问题或建议，请：
1. 提交 GitHub Issue
2. 发送邮件反馈
3. 参与讨论

感谢您的使用！🎉

